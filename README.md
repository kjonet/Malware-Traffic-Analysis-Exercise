# Malware-Traffic-Analysis-Exercise 1 FUNKYLIZARDS
This is a pcap exercise extracted from [Malware-Traffic-Analysis](https://www.malware-traffic-analysis.net/about.html)

# Objective
Analyze the archived pcap in a sandbox environment and determine if there is malicious activity. If malicious traffic is determined write up a report that includes the following :

- A summary explaining what was found
- Victim details (hostname, ip, windows user account)
- attacker details (hostname, IP, domains, ect)

<b>LAN segment data:</b>on the network. 

- <b>LAN segment range:</b>  10.8.19.0/24 (10.8.19.0 through 10.8.19.255)

- <b>Domain:</b>  funkylizards.com

- <b>Domain controller:</b>  110.8.19.8 - Funkylizard-DC

- <b>LAN segment gateway:</b>  10.8.19.1

- <b>LAN segment broadcast address:</b>  10.8.19.255

# Method of Operation 

In this section, I'll discuss my method of operation of how I approached looking through the pcap and how I discovered that there was malicious traffic 

<b>Conversation</b>

I first got started looking through the pcap <b>Conversations</b> just trying to find anything that stuck out. One thing that seemed a bit odd was seeing a high volume of packets exchanged between address 10.8.19.101 and 46.99.175.149. 

![img](https://i.imgur.com/thNNoPt.png)

Over in the TCP tab, I found that a lot of that packet exchange happened over port 443.

![img](https://i.imgur.com/2qjiaGf.png)

Taking things further, I decided to filter out for <b>HTTP</b> traffic. 

The first thing I <b>SHOULD</b> have noticed was the info listed in packet no. 2127. But for some reason, it was packet no. 5091 that stuck out to me first. We'll get to packet no.2127 later though. 

![img](https://i.imgur.com/2rFU32R.png)

Looking at the info for this pcap, we see that there has been a POST request made. POST is an HTTP method used to request a server. It often indicates that a file was uploaded or web forms were submitted. 

![img](https://i.imgur.com/gh72c9m.png)

There's a lot that can be unpacked from this packet. Before looking at the header, I decided to follow the HTTP stream. I found content that seemed to be unusual. 

I can see that there is a user-agent listed in the stream named <b>"Ghost</b>, a headless browser with no GUI. The stream also reveals a lot of executables and even more strange, I was able to find system information:

<b>Client</b>

- Host Name: DESKTOP-M1TFHB6
- Windows Directory: C:\WINDOWS
- Ipv4 Address: 10.8.19.101
- Default Gateway:  10.8.19.1
- DHCP Server: 10.8.19.254
- DNS Servers: 10.8.19.8
- Primary WINS Server: 10.8.19.1
- Computer name: \\DESKTOP-M1TFHB6
- Full Computer name: DESKTOP-M1TFHB6.fuzzylizards.com
- User name: monica.steele
- Logon Domain: FUNKYLIZARDS

<b>Server</b>

- ![img](https://i.imgur.com/NkY9irz.png)

From the bits of information, I've gathered so far a user named Monica Steele has an IP address of 10.8.19.101 and data was sent to a server named Cowboy, with an IP address of, 103.143.41.195. 
Before investigating the Destination IP more, I went to inspect the packet header. 

Within the header, we can see the destination and source MAC addresses. 

<b>Destination:</b> 20:e5:2a:b6:93:f1
<b>Source:</b> 00:08:02:1c:47:ae

There was also this security warning:<b> Expert Info (Warning/Security): Unencrypted HTTP protocol detected over encrypted port, could indicate a dangerous misconfiguration.</b> This means there is unencrypted data being sent over the network. 

Earlier, when filtering for HTTP traffic, I noticed a GET request for a PDF file named <b>"ooiwy"</b> 

![img](https://i.imgur.com/Bu4n9AU.png)

I right-clicked on the packet and followed the HTTP stream. 

Here is what I found: 

![img](https://i.imgur.com/hKa4tOI.png)

The file looks to be coming from host, 185.244.41.29 and the header shows a wildcard in the Accept portion:
Accept: */*

This essentially means the server, whom the client is communicating with, must accept any data sent from the client. In this case, it looks like it's a pdf. 

Looking through the rest of the traffic, it appears that the host with the IP address 185.244.41.29 has made a lot of requests to the host with the IP address of 10.8.19.101 (the IP address of Monica Steel)

![img](https://i.imgur.com/K5FeUiV.png)

I continued to follow more TCP streams that contained the source IP OF 185.244.41.29 and the destination IP of 10.8.19.101 and found that the <b>ooiwy.pdf</b> file was 
I wanted to inspect the file since it kept appearing in the stream. To do this, I selected packet no. 2127 and exported it and extracted the md5 hash via Kali Linux command line. 

![img](https://i.imgur.com/MDrG0sZ.png)

I then took that hash and inserted it into a database called Virus Total. According to the database, the file was flagged as potential malware and looked to be a trojan. 

![img](https://i.imgur.com/YxEfkjR.png)

The database gives useful information such as various IP addresses associated with the malware and the websites it can be found on. 

![img](https://i.imgur.com/DiITggM.png)

One thing that stood out was the website <b>api.ipify.org/</b> as it looked familiar so I decided to filter it out using the query, <b>_ws.col matches "api.ipify.org"</b> and found 3 packets associated with the URL. 
It looks like 

The TCP flags also show a handful of <b>[PSH, ACK]</b> TCP signatures. This means the sender is requesting immediate delivery of the data. As in, this attacker is persistent in sharing their malware with the host. 

Now that potential malware has been discovered, what does this mean? 

<h1>Summery</h1>
On August 19th, 2021 at 3:40 PM it appears that a pdf file containing trojan malware was downloaded on the device (Hostname: DESKTOP-M1TFHB6) of the user, Monica Steele. 

<b>Victim details</b>
- Host Name: DESKTOP-M1TFHB6
- Windows user: monica.steele
- Ipv4 Address: 10.8.19.101
- MAC: 00:08:02:1c:47:ae

<b>Indicators of Compromise (IOCs)</b>
- IP: 185.244.41.29 
- MAC: 20:e5:2a:b6:93:f1
- Malicious file: ooiwy.pdf
- MD5 Hash value: 4e4ae70b6346eae111e31716dc76bc23
- SHA256 Hash value: f25a780095730701efac67e9d5b84bc289afea56d96d8aff8a44af69ae606404
- Associated URL's: api.ipify.org
- file type: DLL executable

# Closing Thoughts 
From this exercise, we were able to inspect a pcap file that did indeed have malware nested in it. We were able to observe different protocols, like HTTP, follow the stream, and find bits of information that led us to discover details on the victim and the sender of the malware that turned out to be a trojan. This was a great exercise and served as a reminder as to why it's so important to know what to look for when observing network traffic. Learning traffic analysis and a powerful packet capture tool like Wireshark enables security analysis to stay on top of potential security threats.  

  

  
  










